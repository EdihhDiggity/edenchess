<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data</title>
    <link rel="stylesheet" href="../static/styles/gameInsights.css">
</head>

<body>
    <div>
        <h1>Data based on games in the previous month for {{username}}</h1>
    </div>
    <hr>
    <div name="game_display" id="game_display">

    </div>

    <script>
        const username = "{{ username }}";
        console.log("Fetching data for:", username);

        // fetch(`/api/analysis/${username}`)
        //     .then(response => {
        //         console.log("Raw response:", response);
        //         return response.text();  // <-- STEP 1: Get raw text instead of JSON
        //     })
        //     .then(raw => {
        //         console.log("Raw response body:", raw);  // <-- STEP 2: Print the raw output
        //         document.getElementById("output").textContent = raw;  // <-- STEP 3: Display raw content
        //     })
        //     .catch(error => {
        //         console.error("Fetch error:", error);
        //         document.getElementById("output").textContent = "Failed to load data: " + error;
        //     });
        fetch(`/api/analysis/${username}`)
            .then(response => {
                console.log("Raw response:", response);
                return response.text();  // get raw JSON string
            })
            .then(raw => {
                console.log("Raw response body:", raw);

                const data = JSON.parse(raw);

                console.log("Parsed data:", data);

                for (let i = 0; i < data.length; i++) {
                    var date = data[i].date;
                    var black = data[i].black;
                    var black_rating = data[i].black_rating;
                    var white = data[i].white;
                    var white_rating = data[i].white_rating;
                    var result = data[i].result;
                    var opening = data[i].opening;

                    //console.log("Opening:", opening);
                    var dateText = document.createElement("text");
                    dateText.className = "innerGameCardText";
                    dateText.innerHTML = date;

                    var playerText = document.createElement("text");
                    playerText.className = "innerGameCardText";
                    playerText.innerHTML = `${white} (${white_rating}) vs ${black} (${black_rating}) ${result}`;


                    var openingText = document.createElement("text");
                    openingText.className = "innerGameCardText";
                    openingText.innerHTML = opening;

                    var gameCard = document.createElement("div");
                    gameCard.className = "gameCard";

                    var out = document.getElementById("game_display");

                    gameCard.appendChild(dateText);
                    gameCard.appendChild(playerText);
                    gameCard.appendChild(openingText);

                    out.appendChild(gameCard);
                }


                

                // document.getElementById("output").textContent = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                console.error("Fetch error:", error);
                document.getElementById("output").textContent = "Failed to load data: " + error;
            });
    </script>

    <pre id="output"></pre>
</body>

</html>